---
import { getLangFromUrl, useTranslations } from "../../i18n/utils";
import { createReader } from "@keystatic/core/reader";
import keystaticConfig from "../../../keystatic.config";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

const reader = createReader(process.cwd(), keystaticConfig);
const members = await reader.collections.team.all();
---

<section id="team-section" class="border-accent-dark border-b-3 px-8 py-20 max-w-[100vw] overflow-hidden max-sm:py-12">
  <!-- Header -->
  <div class="flex max-sm:flex-col items-end justify-between gap-8 mb-16 max-sm:mb-10">
    <h2 class="text-6xl font-light text-accent-dark max-sm:text-4xl team-heading">
      <span class="font-serif italic">{t("team.heading.serif")}</span> {t("team.heading.rest")}
    </h2>
    <p class="text-beige-700 max-w-sm text-right max-sm:text-left team-desc">
      {t("team.desc")}
    </p>
  </div>

  <!-- Cards -->
  <div class="grid grid-cols-[repeat(auto-fit,minmax(min(100%,18rem),1fr))] gap-px bg-accent-dark border border-accent-dark">
    {
      members.map((member) => (
        <div class="team-card bg-beige-500 flex flex-col">
          <!-- Initials placeholder -->
          <div class="bg-accent-dark aspect-square flex items-center justify-center">
            <span class="font-serif italic text-beige-500 select-none" style="font-size: clamp(4rem, 10vw, 8rem); opacity: 0.35;">
              {member.entry.initials}
            </span>
          </div>
          <!-- Info -->
          <div class="px-8 py-8 flex flex-col gap-3 flex-1">
            <div>
              <h3 class="text-xl font-light text-accent-dark">{member.entry.name}</h3>
              <p class="text-xs uppercase tracking-widest text-beige-700 mt-1">
                {member.entry[`role_${lang}` as keyof typeof member.entry]}
              </p>
            </div>
            <div class="w-8 h-px bg-accent-dark opacity-30" />
            <p class="text-sm text-beige-700 leading-relaxed">
              {member.entry[`bio_${lang}` as keyof typeof member.entry]}
            </p>
            <p class="text-xs text-beige-700 mt-auto pt-4 uppercase tracking-widest">
              {member.entry.experience} {t("team.experience")}
            </p>
          </div>
        </div>
      ))
    }
  </div>
</section>

<script>
  import { gsap } from "gsap";
  import { ScrollTrigger } from "gsap/ScrollTrigger";

  gsap.registerPlugin(ScrollTrigger);

  gsap.from(".team-heading", {
    scrollTrigger: {
      trigger: "#team-section",
      start: "top 80%",
    },
    opacity: 0,
    x: -50,
    duration: 0.9,
    ease: "power3.out",
  });

  gsap.from(".team-desc", {
    scrollTrigger: {
      trigger: "#team-section",
      start: "top 80%",
    },
    opacity: 0,
    x: 50,
    duration: 0.9,
    ease: "power3.out",
  });

  gsap.from(".team-card", {
    scrollTrigger: {
      trigger: "#team-section",
      start: "top 70%",
    },
    opacity: 0,
    y: 60,
    duration: 0.8,
    stagger: 0.2,
    ease: "power3.out",
  });
</script>
