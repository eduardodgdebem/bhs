---
import Button from "../ui/Button.astro";
import { getLangFromUrl, useTranslations } from "../../i18n/utils";
import { createReader } from "@keystatic/core/reader";
import keystaticConfig from "../../../keystatic.config";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

const reader = createReader(process.cwd(), keystaticConfig);
const testimonials = await reader.collections.clients.all();
---

<section id="clients-section" class="border-accent-dark border-b-3 px-8 py-20 max-w-[100vw] overflow-hidden max-sm:py-12">
  <div class="flex max-sm:flex-col items-end justify-between gap-8 mb-16 max-sm:mb-10">
    <h2 class="text-6xl font-light text-accent-dark max-sm:text-4xl clients-heading">
      <span class="font-serif italic">{t("clients.heading.serif")}</span> {t("clients.heading.rest")}
    </h2>
    <Button href="tel:+12393188366" variant="dark" size="sm" class="clients-cta whitespace-nowrap">
      {t("clients.cta")}
    </Button>
  </div>

  <div class="grid grid-cols-[repeat(auto-fit,minmax(min(100%,18rem),1fr))] gap-px bg-accent-dark border border-accent-dark">
    {
      testimonials.map((item) => (
        <div class="testimonial-card bg-beige-500 px-10 py-12 max-sm:px-8 max-sm:py-10 flex flex-col gap-6">
          <span class="font-serif italic text-accent-dark leading-none select-none" style="font-size: 5rem; line-height: 1; opacity: 0.15;">&ldquo;</span>
          <p class="text-accent-dark text-sm leading-relaxed -mt-6">
            {item.entry[`quote_${lang}` as keyof typeof item.entry]}
          </p>
          <div class="mt-auto flex flex-col gap-1 pt-6 border-t border-accent-dark" style="border-color: rgba(14,59,49,0.15);">
            <p class="text-accent-dark font-medium text-sm">{item.entry.name}</p>
            <p class="text-beige-700 text-xs uppercase tracking-widest">
              {item.entry[`occasion_${lang}` as keyof typeof item.entry]}
            </p>
          </div>
        </div>
      ))
    }
  </div>
</section>

<script>
  import { gsap } from "gsap";
  import { ScrollTrigger } from "gsap/ScrollTrigger";

  gsap.registerPlugin(ScrollTrigger);

  gsap.from(".clients-heading", {
    scrollTrigger: {
      trigger: "#clients-section",
      start: "top 80%",
    },
    opacity: 0,
    x: -50,
    duration: 0.9,
    ease: "power3.out",
  });

  gsap.from(".clients-cta", {
    scrollTrigger: {
      trigger: "#clients-section",
      start: "top 80%",
    },
    opacity: 0,
    x: 50,
    duration: 0.9,
    ease: "power3.out",
  });

  gsap.from(".testimonial-card", {
    scrollTrigger: {
      trigger: "#clients-section",
      start: "top 70%",
    },
    opacity: 0,
    y: 50,
    duration: 0.8,
    stagger: 0.2,
    ease: "power3.out",
  });
</script>
