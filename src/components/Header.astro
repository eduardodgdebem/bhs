---
import { Image } from "astro:assets";
import { Icon } from "astro-icon/components";
import LogoImg from "../assets/bhs-logo.png";
import LogoSmallImg from "../assets/bhs-logo-small-dark.png"
import { getLangFromUrl, useTranslations } from "../i18n/utils";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

const langLinks = [
  { code: "en", label: "EN", href: "/" },
  { code: "pt", label: "PT", href: "/pt" },
  { code: "sp", label: "SP", href: "/sp" },
];
---

<header
  class="h-24 flex items-center px-10 text-accent-dark text-xl sticky top-0 bg-beige-500 z-10"
>
  <a href="/" class="h-16 flex gap-2">
    <Image src={LogoSmallImg} alt="Brazilian Hair Studio" class="h-full w-full object-contain" />
    <Image src={LogoImg} alt="Brazilian Hair Studio" class="max-sm:hidden h-full w-full object-contain" />
  </a>

  <nav class="hidden md:flex items-center gap-4 ml-auto">
    <a href="/home">{t("nav.home")}</a>
    <a href="/about">{t("nav.about")}</a>
    <a href="/services">{t("nav.services")}</a>
    <a href="/team">{t("nav.team")}</a>
    <a href="/appointment" class="flex items-center gap-2">
      <Icon name="material-symbols-light:phone-enabled" />
      {t("nav.book")}</a>

    <div class="flex items-center gap-2 ml-4 pl-4 border-l border-accent-dark/20 text-sm">
      {
        langLinks.map((l, i) => (
          <>
            {i > 0 && <span class="text-beige-700">|</span>}
            <a
              href={l.href}
              class={
                lang === l.code
                  ? "font-semibold text-accent-dark"
                  : "text-beige-700 hover:text-accent-dark transition-colors duration-200"
              }
            >
              {l.label}
            </a>
          </>
        ))
      }
    </div>
  </nav>

  <button
    id="menu-toggle"
    class="md:hidden ml-auto p-2"
    aria-label="Toggle menu"
    aria-expanded="false"
    aria-controls="mobile-menu"
  >
    <Icon id="icon-menu" name="material-symbols-light:menu" class="w-8 h-8" />
    <Icon
      id="icon-close"
      name="material-symbols-light:close"
      class="w-8 h-8 hidden"
    />
  </button>
</header>

<nav
  id="mobile-menu"
  class="md:hidden hidden flex-col bg-beige-500 text-accent-dark text-xl px-10 py-6 gap-6 sticky top-24 z-10"
>
  <a href="/home">{t("nav.home")}</a>
  <a href="/about">{t("nav.about")}</a>
  <a href="/services">{t("nav.services")}</a>
  <a href="/team">{t("nav.team")}</a>
  <a href="/appointment">{t("nav.book")}</a>

  <div class="flex items-center gap-3 pt-4 border-t border-accent-dark/20 text-base">
    {
      langLinks.map((l, i) => (
        <>
          {i > 0 && <span class="text-beige-700">|</span>}
          <a
            href={l.href}
            class={
              lang === l.code
                ? "font-semibold text-accent-dark"
                : "text-beige-700 hover:text-accent-dark transition-colors duration-200"
            }
          >
            {l.label}
          </a>
        </>
      ))
    }
  </div>
</nav>

<script>
  const toggle = document.getElementById("menu-toggle")!;
  const menu = document.getElementById("mobile-menu")!;
  const iconMenu = document.getElementById("icon-menu")!;
  const iconClose = document.getElementById("icon-close")!;

  toggle.addEventListener("click", () => {
    const isOpen = !menu.classList.contains("hidden");

    menu.classList.toggle("hidden", isOpen);
    menu.classList.toggle("flex", !isOpen);
    iconMenu.classList.toggle("hidden", !isOpen);
    iconClose.classList.toggle("hidden", isOpen);
    toggle.setAttribute("aria-expanded", String(!isOpen));
  });
</script>
